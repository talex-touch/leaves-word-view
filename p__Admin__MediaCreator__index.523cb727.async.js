"use strict";(self.webpackChunkyupi_antd_frontend_init=self.webpackChunkyupi_antd_frontend_init||[]).push([[2557],{50745:function(le,L,r){r.r(L),r.d(L,{MediaTypeSelect:function(){return ae},default:function(){return Ce}});var z=r(26068),_=r.n(z),k=r(90228),p=r.n(k),Y=r(87999),E=r.n(Y),B=r(48305),F=r.n(B),O=r(51239),$=r(56435),K=r(7039),S=r(80438),Z=r(1573),P=r(75271),e=r(52676),re=function(){var I=E()(p()().mark(function u(a){var o;return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=S.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),n.prev=1,n.next=4,(0,O.F_)(a);case 4:return o(),S.ZP.success("\u521B\u5EFA\u6210\u529F"),n.abrupt("return",!0);case 9:return n.prev=9,n.t0=n.catch(1),o(),S.ZP.error("\u521B\u5EFA\u5931\u8D25\uFF0C"+n.t0.message),n.abrupt("return",!1);case 14:case"end":return n.stop()}},u,null,[[1,9]])}));return function(a){return I.apply(this,arguments)}}(),V=function(u){var a=u.visible,o=u.columns,d=u.onSubmit,n=u.onCancel;return(0,e.jsx)(Z.Z,{destroyOnClose:!0,title:"\u521B\u5EFA\u5A92\u4F53",open:a,footer:null,onCancel:function(){n==null||n()},children:(0,e.jsx)($.Z,{type:"form",columns:o,onSubmit:function(){var f=E()(p()().mark(function b(C){var j;return p()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,re(C);case 2:j=M.sent,j&&(d==null||d(C));case 4:case"end":return M.stop()}},b)}));return function(b){return f.apply(this,arguments)}}()})})},ne=V,W=r(21047),s=function(){var I=E()(p()().mark(function u(a){var o;return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=S.ZP.loading("\u6B63\u5728\u66F4\u65B0"),n.prev=1,n.next=4,(0,W.dj)(a);case 4:return o(),S.ZP.success("\u66F4\u65B0\u6210\u529F"),n.abrupt("return",!0);case 9:return n.prev=9,n.t0=n.catch(1),o(),S.ZP.error("\u66F4\u65B0\u5931\u8D25\uFF0C"+n.t0.message),n.abrupt("return",!1);case 14:case"end":return n.stop()}},u,null,[[1,9]])}));return function(a){return I.apply(this,arguments)}}(),i=function(u){var a=u.oldData,o=u.visible,d=u.columns,n=u.onSubmit,f=u.onCancel;return a?(0,e.jsx)(Z.Z,{destroyOnClose:!0,title:"\u66F4\u65B0",open:o,footer:null,onCancel:function(){f==null||f()},children:(0,e.jsx)($.Z,{type:"form",columns:d,form:{initialValues:a},onSubmit:function(){var b=E()(p()().mark(function C(j){var x;return p()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,s(_()(_()({},j),{},{id:a.id}));case 2:x=h.sent,x&&(n==null||n(j));case 4:case"end":return h.stop()}},C)}));return function(C){return b.apply(this,arguments)}}()})}):(0,e.jsx)(e.Fragment,{})},y=i,D=r(65496),t=r(97128),se=r(451),G=r(8795),ie=r(69116),H=r(97369),X=r(49204),oe=r(15558),de=r.n(oe),ce=r(56192),me=r(53475),ve=r(29745),pe=r(4074),T=r(31772),fe=H.Z.Paragraph,he=function(u){var a=u.data,o=(0,P.useMemo)(function(){return console.log("data",a),a.map(function(d){var n=d.event,f=d.message,b=f.nodeIsFinish,C=f.content;return{status:b?"success":"pending",title:"".concat(f.nodeTitle," #").concat(f.nodeSeqID),description:"".concat(n),icon:(0,e.jsx)(ce.Z,{}),extra:(0,e.jsx)(X.ZP,{type:"text",icon:(0,e.jsx)(me.Z,{})}),content:(0,e.jsx)(H.Z,{children:(0,e.jsx)(fe,{children:C})})}})},[a]);return(0,e.jsx)(ve.Z,{items:o,collapsible:!0})},ge=function(u){var a=u.data,o=(0,P.useState)({}),d=F()(o,2),n=d[0],f=d[1],b=(0,P.useState)(!1),C=F()(b,2),j=C[0],x=C[1];(0,P.useEffect)(function(){if(a!=null&&a.info){var h=a.info,R=JSON.parse(h);f(R)}},[a]);var M=(0,P.useMemo)(function(){var h=n.workflow;if(!h)return(0,e.jsx)(e.Fragment,{children:"-"});var R=de()(h).find(function(l){var c;return((c=l.message)===null||c===void 0?void 0:c.nodeTitle)==="End"});if(!R)return(0,e.jsx)(e.Fragment,{children:"\u7B49\u5F85\u751F\u6210\u5B8C\u6210..."});var Q=R.message.content;if(!Q)return(0,e.jsx)(e.Fragment,{children:"\u5A92\u4F53\u6570\u636E\u751F\u6210\u5931\u8D25"});try{var U=JSON.parse(Q),g=U.output;return g?(a==null?void 0:a.media_type)==="IMAGE"?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(pe.Z,{width:200,src:g})}):(0,e.jsx)("audio",{controls:!0,src:"data:audio/mp3;base64,".concat(h),children:"Your browser does not support the audio element."}):(0,e.jsx)(e.Fragment,{children:JSON.stringify(U,null,2)})}catch(l){return(0,e.jsxs)(e.Fragment,{children:["\u5A92\u4F53\u6570\u636E\u751F\u6210\u5931\u8D25 ",JSON.stringify(l,null,2)]})}},[n]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{display:"flex",flex:"1",gap:"0.5rem",alignItems:"center"},children:(0,e.jsx)(X.ZP,{onClick:function(){return x(!0)},children:"\u9884\u89C8"})}),(0,e.jsxs)(Z.Z,{destroyOnClose:!0,title:"\u5A92\u4F53\u521B\u4F5C\u8BE6\u60C5",open:j,footer:null,onCancel:function(){return x(!1)},className:"preview-modal",width:"80%",style:{maxWidth:"90vw"},children:[(0,e.jsxs)(T.Z,{bordered:!0,column:2,children:[(0,e.jsx)(T.Z.Item,{label:"ID",children:a==null?void 0:a.id}),(0,e.jsx)(T.Z.Item,{label:"\u540D\u79F0",children:a==null?void 0:a.media_type}),(0,e.jsx)(T.Z.Item,{label:"\u521B\u5EFA\u65F6\u95F4",children:a==null?void 0:a.created_at}),(0,e.jsx)(T.Z.Item,{label:"\u521B\u5EFA\u8005ID",children:a==null?void 0:a.creator_id}),(0,e.jsx)(T.Z.Item,{label:"\u65E5\u5FD7ID",children:n.log_id}),(0,e.jsx)(T.Z.Item,{label:"\u72B6\u6001",children:n.status}),(0,e.jsx)(T.Z.Item,{label:"\u9884\u89C8",span:2,children:M})]}),(0,e.jsx)("h3",{className:"my-4 font-medium",children:"\u601D\u7EF4\u94FE"}),(0,e.jsx)(he,{data:n.workflow})]})]})},je=ge,ae=function(){var u=[{label:"\u5B9E\u51B5\u56FE",value:"LIVE"},{label:"\u9759\u6001\u89C6\u9891",value:"STATIC_VIDEO"},{label:"\u97F3\u9891",value:"AUDIO"},{label:"\u89C6\u9891",value:"VIDEO"},{label:"\u9759\u6001\u56FE\u7247",value:"IMAGE"}];return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(se.Z,{options:u})})},ye=function(){var u=(0,P.useState)(!1),a=F()(u,2),o=a[0],d=a[1],n=(0,P.useState)(!1),f=F()(n,2),b=f[0],C=f[1],j=(0,P.useRef)(),x=(0,P.useState)(),M=F()(x,2),h=M[0],R=M[1],Q=function(){var g=E()(p()().mark(function l(c){var m,N;return p()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(m=S.ZP.loading("\u6B63\u5728\u5F52\u6863"),c){v.next=3;break}return v.abrupt("return",!0);case 3:return v.prev=3,v.next=6,(0,O.QE)({id:c.id});case 6:return m(),S.ZP.success("\u5F52\u6863\u6210\u529F"),j==null||(N=j.current)===null||N===void 0||N.reload(),v.abrupt("return",!0);case 12:return v.prev=12,v.t0=v.catch(3),m(),S.ZP.error("\u5F52\u6863\u5931\u8D25\uFF0C"+v.t0.message),v.abrupt("return",!1);case 17:case"end":return v.stop()}},l,null,[[3,12]])}));return function(c){return g.apply(this,arguments)}}(),U=[{title:"ID",dataIndex:"id",valueType:"text",hideInForm:!0},{title:"\u7C7B\u578B",dataIndex:"media_type",valueType:"select",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7C7B\u578B"}]},renderFormItem:function(){return(0,e.jsx)(ae,{})},render:function(l,c){var m=c.media_type;return m?m==="LIVE"?(0,e.jsx)(G.Z,{color:"default",children:"\u5B9E\u51B5\u56FE"}):m==="STATIC_VIDEO"?(0,e.jsx)(G.Z,{color:"default",children:"\u9759\u6001\u89C6\u9891"}):m==="AUDIO"?(0,e.jsx)(G.Z,{color:"default",children:"\u97F3\u9891"}):m==="VIDEO"?(0,e.jsx)(G.Z,{color:"default",children:"\u89C6\u9891"}):m==="IMAGE"?(0,e.jsx)(G.Z,{color:"default",children:"\u9759\u6001\u56FE\u7247"}):(0,e.jsx)(e.Fragment,{children:"UNKNOWN"}):(0,e.jsx)(e.Fragment,{children:"ERROR"})}},{title:"\u5185\u5BB9",dataIndex:"content",valueType:"textarea",formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9"}]},render:function(l,c){return(0,e.jsx)(je,{data:c},c.id)}},{title:"\u521B\u5EFA\u65F6\u95F4",sorter:!0,dataIndex:"created_at",valueType:"dateTime",hideInSearch:!0,hideInForm:!0},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",render:function(l,c){return(0,e.jsx)(ie.Z,{size:"middle",children:(0,e.jsx)(H.Z.Link,{type:"danger",onClick:function(){return Q(c)},children:"\u5F52\u6863"})})}}];return(0,e.jsxs)(t._z,{children:[(0,e.jsx)($.Z,{headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:j,rowKey:"key",search:{labelWidth:120},toolBarRender:function(){return[(0,e.jsxs)(X.ZP,{type:"primary",onClick:function(){d(!0)},children:[(0,e.jsx)(D.Z,{})," \u65B0\u5EFA"]},"primary")]},request:function(){var g=E()(p()().mark(function l(c,m,N){var J,v,q,te,ee,w,ue;return p()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return q=(J=Object.keys(m))===null||J===void 0?void 0:J[0],te=(v=m==null?void 0:m[q])!==null&&v!==void 0?v:void 0,A.next=4,(0,O.uh)(_()(_()({},c),{},{sortField:q,sortOrder:te},N));case 4:return ee=A.sent,w=ee.data,ue=ee.code,A.abrupt("return",{success:ue===0,data:(w==null?void 0:w.records)||[],total:Number(w==null?void 0:w.total)||0});case 8:case"end":return A.stop()}},l)}));return function(l,c,m){return g.apply(this,arguments)}}(),columns:U}),(0,e.jsx)(ne,{visible:o,columns:U,onSubmit:function(){var l;d(!1),(l=j.current)===null||l===void 0||l.reload()},onCancel:function(){d(!1)}}),(0,e.jsx)(y,{visible:b,columns:U,oldData:h,onSubmit:function(){var l;C(!1),R(void 0),(l=j.current)===null||l===void 0||l.reload()},onCancel:function(){C(!1)}})]})},Ce=ye},51239:function(le,L,r){r.d(L,{F_:function(){return F},QE:function(){return $},uh:function(){return P}});var z=r(90228),_=r.n(z),k=r(26068),p=r.n(k),Y=r(87999),E=r.n(Y),B=r(7039);function F(s,i){return O.apply(this,arguments)}function O(){return O=E()(_()().mark(function s(i,y){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,B.request)("/api/media_creator/add",p()({method:"POST",headers:{"Content-Type":"application/json"},data:i},y||{})));case 1:case"end":return t.stop()}},s)})),O.apply(this,arguments)}function $(s,i){return K.apply(this,arguments)}function K(){return K=E()(_()().mark(function s(i,y){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,B.request)("/api/media_creator/delete",p()({method:"POST",headers:{"Content-Type":"application/json"},data:i},y||{})));case 1:case"end":return t.stop()}},s)})),K.apply(this,arguments)}function S(s,i){return Z.apply(this,arguments)}function Z(){return Z=_asyncToGenerator(_regeneratorRuntime().mark(function s(i,y){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/media_creator/get/vo",_objectSpread({method:"GET",params:_objectSpread({},i)},y||{})));case 1:case"end":return t.stop()}},s)})),Z.apply(this,arguments)}function P(s,i){return e.apply(this,arguments)}function e(){return e=E()(_()().mark(function s(i,y){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,B.request)("/api/media_creator/list/page",p()({method:"POST",headers:{"Content-Type":"application/json"},data:i},y||{})));case 1:case"end":return t.stop()}},s)})),e.apply(this,arguments)}function re(s,i){return V.apply(this,arguments)}function V(){return V=_asyncToGenerator(_regeneratorRuntime().mark(function s(i,y){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/media_creator/list/page/vo",_objectSpread({method:"POST",headers:{"Content-Type":"application/json"},data:i},y||{})));case 1:case"end":return t.stop()}},s)})),V.apply(this,arguments)}function ne(s,i){return W.apply(this,arguments)}function W(){return W=_asyncToGenerator(_regeneratorRuntime().mark(function s(i,y){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/media_creator/my/list/page/vo",_objectSpread({method:"POST",headers:{"Content-Type":"application/json"},data:i},y||{})));case 1:case"end":return t.stop()}},s)})),W.apply(this,arguments)}}}]);
